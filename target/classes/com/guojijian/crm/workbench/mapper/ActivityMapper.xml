<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.guojijian.crm.workbench.mapper.ActivityMapper" >
  <resultMap id="BaseResultMap" type="com.guojijian.crm.workbench.pojo.Activity" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 09 16:22:57 CST 2022.
    -->
    <id column="id" property="id" jdbcType="CHAR" />
    <result column="owner" property="owner" jdbcType="CHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="start_date" property="startDate" jdbcType="CHAR" />
    <result column="end_date" property="endDate" jdbcType="CHAR" />
    <result column="cost" property="cost" jdbcType="VARCHAR" />
    <result column="description" property="description" jdbcType="VARCHAR" />
    <result column="create_date" property="createDate" jdbcType="CHAR" />
    <result column="create_by" property="createBy" jdbcType="VARCHAR" />
    <result column="edit_date" property="editDate" jdbcType="CHAR"/>
    <result column="edit_by" property="editBy" jdbcType="CHAR"/>
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 09 16:22:57 CST 2022.
    -->
    delete from tbl_activity
    where id = #{id,jdbcType=CHAR}
  </delete>

  <!--int insertActivity(Activity activity);-->
  <insert id="insertActivity" parameterType="com.guojijian.crm.workbench.pojo.Activity" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 09 16:22:57 CST 2022.
    -->
    insert into tbl_activity (id, owner, name, start_date,
    end_date, cost, description,
    create_date, create_by)
    values (#{id,jdbcType=CHAR}, #{owner,jdbcType=CHAR}, #{name,jdbcType=VARCHAR}, #{startDate,jdbcType=CHAR},
    #{endDate,jdbcType=CHAR}, #{cost,jdbcType=VARCHAR}, #{description,jdbcType=VARCHAR},
    #{createDate,jdbcType=CHAR}, #{createBy,jdbcType=VARCHAR})
  </insert>

  <!--List<Activity> selectActivityByConditionForPage(Map<String, Object> map);-->
  <select id="selectActivityByConditionForPage" resultMap="BaseResultMap">
    SELECT a.id,u1.name owner,a.name,a.start_date,a.end_date,a.cost,a.description,a.create_date,u2.name create_by,
    a.edit_date,u3.name edit_by
    FROM tbl_activity a
    JOIN tbl_user u1 ON a.owner=u1.id
    JOIN tbl_user u2 ON a.create_by=u2.id
    LEFT JOIN tbl_user u3 ON a.edit_by=u3.id
    <where>
      <if test="name!=null and name!=''">
        and a.name LIKE '%' #{name} '%'
      </if>
      <if test="owner!='' and owner!=null">
        and u1.name LIKE '%' #{owner} '%'
      </if>
      <if test="startDate!='' and startDate!=null">
        and a.start_date>=#{startDate}
      </if>
      <if test="endDate!='' and endDate!=null">
        and a.end_date&lt;=#{endDate}
      </if>
    </where>
    ORDER BY a.start_date ASC
  </select>

  <!--int deleteActivityByIds(String[] ids);-->
  <delete id="deleteActivityByIds">
    DELETE FROM tbl_activity WHERE id IN
    <foreach collection="ids" item="id" separator="," open="(" close=")">
      #{id}
    </foreach>
  </delete>

  <!--Activity selectActivityById(String id);-->
  <select id="selectActivityById" resultMap="BaseResultMap" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 09 16:22:57 CST 2022.
    -->
    select id, owner, name, start_date, end_date, cost, description
    from tbl_activity
    where id = #{id,jdbcType=CHAR}
  </select>

  <!--int updateActivityById(Activity activity);-->
  <update id="updateActivityById" parameterType="com.guojijian.crm.workbench.pojo.Activity" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 09 16:22:57 CST 2022.
    -->
    update tbl_activity
    set owner = #{owner,jdbcType=CHAR},
    name = #{name,jdbcType=VARCHAR},
    start_date = #{startDate,jdbcType=CHAR},
    end_date = #{endDate,jdbcType=CHAR},
    cost = #{cost,jdbcType=VARCHAR},
    description = #{description,jdbcType=VARCHAR},
    edit_date = #{editDate,jdbcType=CHAR},
    edit_by = #{editBy,jdbcType=CHAR}
    where id = #{id,jdbcType=CHAR}
  </update>

  <!--List<Activity> selectAll();-->
  <select id="selectAll" resultMap="BaseResultMap" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 09 16:22:57 CST 2022.
    -->
    select a.id,u1.name owner, a.name, a.start_date, a.end_date, a.cost, a.description, a.create_date,
    u2.name create_by,a.edit_date,u3.name edit_by
    from tbl_activity a
    JOIN tbl_user u1 ON u1.id=a.owner
    JOIN tbl_user u2 ON u2.id=a.create_by
    LEFT JOIN tbl_user u3 ON u3.id=a.edit_by
  </select>

  <!--List<Activity> selectActivityByIds(String[] ids);-->
  <select id="selectActivityByIds" resultMap="BaseResultMap">
    SELECT a.id,u1.name owner, a.name, a.start_date, a.end_date, a.cost, a.description, a.create_date,
    u2.name create_by,a.edit_date,u3.name edit_by
    FROM tbl_activity a
    JOIN tbl_user u1 ON u1.id=a.owner
    JOIN tbl_user u2 ON u2.id=a.create_by
    LEFT JOIN tbl_user u3 ON u3.id=a.edit_by
    WHERE a.id IN
    <foreach collection="array" item="id" separator="," open="(" close=")">
      #{id}
    </foreach>

  </select>

  <!--int insertActivitys(List<Activity> activityList);-->
  <insert id="insertActivitys">
    INSERT INTO tbl_activity(id,owner,name,start_date,end_date,cost,description,create_date,create_by) VALUES
    <foreach collection="list" item="activity" separator=",">
      (#{activity.id},#{activity.owner},#{activity.name},#{activity.startDate},#{activity.endDate},#{activity.cost}
      ,#{activity.description},#{activity.createDate},#{activity.createBy})
    </foreach>
  </insert>

  <!--Activity selectActivityDetailById(String id);-->
  <select id="selectActivityDetailById" resultMap="BaseResultMap">
    SELECT a.id,u1.name owner,a.name,a.start_date,a.end_date,a.cost,a.description,a.create_date,u2.name create_by,
    a.edit_date,u3.name edit_by
    FROM tbl_activity a
    JOIN tbl_user u1 ON u1.id=a.owner
    JOIN tbl_user u2 ON u2.id=a.create_by
    LEFT JOIN tbl_user u3 ON u3.id=a.edit_by
    WHERE a.id=#{id}
  </select>

  <!--List<Activity> selectActivityForDetailByClueId(String clueId);-->
  <select id="selectActivityForDetailByClueId" resultMap="BaseResultMap">
    SELECT a.id,a.name,a.start_date,a.end_date,u.name owner
    FROM tbl_activity a
    JOIN tbl_user u ON u.id=a.owner
    JOIN tbl_clue_activity_relation car ON car.activity_id=a.id
    WHERE car.clue_id=#{clueId}
  </select>

  <!--List<Activity> selectActivityNoBundByName(@Param("name") String name,@Param("clueId") String clueId);-->
  <select id="selectActivityNoBundByName" resultMap="BaseResultMap">
    SELECT a.id,a.name,a.start_date,a.end_date,u.name owner
    FROM tbl_activity a
    JOIN tbl_user u ON u.id=a.owner
    LEFT JOIN tbl_clue_activity_relation car ON car.activity_id=a.id
    <where>
        (car.clue_id!=#{clueId} OR car.clue_id is NULL)
        <if test="name!=null and name!=''">
          and a.name LIKE '%' #{name} '%'
        </if>
    </where>
  </select>

  <!--List<Activity> selectActivityForBundByName(Map<String,Object> map);-->
  <select id="selectActivityForBundByName" resultMap="BaseResultMap">
    SELECT a.id,a.name,a.start_date,a.end_date, u.name owner
    FROM tbl_activity a
    JOIN tbl_user u ON u.id=a.owner
    JOIN tbl_clue_activity_relation car ON car.activity_id=a.id
    <where>
        a.name LIKE '%' #{activityName} '%'
        <if test="clueId!=null and clueId!=''">
          and car.clue_id=#{clueId}
        </if>
    </where>
  </select>

  <!--List<Activity> selectActivityForPartInfoByName(String name);-->
  <select id="selectActivityForPartInfoByName" resultMap="BaseResultMap">
    select a.id,u1.name owner, a.name, a.start_date, a.end_date
    from tbl_activity a
    JOIN tbl_user u1 ON u1.id=a.owner
    WHERE a.name LIKE '%' #{name} '%'
  </select>

  <!--String selectActivityNameById(String id);-->
  <select id="selectActivityNameById" resultType="java.lang.String">
    SELECT name
    FROM tbl_activity
    WHERE id=#{id}
  </select>
</mapper>